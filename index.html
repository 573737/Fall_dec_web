<!DOCTYPE html>
<html lang="en">
<head>
  <title>Sensor Readings Widget</title>
  <style>
    /* Basic widget styling */
    .sensor-widget {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      max-width: 400px;
      background-color: #f9f9f9;
    }

    .sensor-section {
      margin-bottom: 10px;
    }

    .sensor-section h3 {
      margin-top: 0;
    }

    .sensor-reading {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
    }
  </style>
  <script>
    let velX = 0, velY = 0, velZ = 0;
    let lastTimestamp = null;

    // Normalization function
    function normalize(value, min, max) {
      return (value - min) / (max - min);
    }

    let acceleration = { x: 0, y: 0, z: 0 };
    let gyroscope = { x: 0, y: 0, z: 0 };
    let orientation = { alpha: 0, beta: 0, gamma: 0 };
    let derivedMagnetometer = { x: 0, y: 0, z: 0 }; // Placeholder for derived magnetometer

    if (window.DeviceMotionEvent) {
      window.addEventListener('devicemotion', function (event) {
        const { acceleration: acc, rotationRate, timeStamp } = event;

        if (lastTimestamp !== null) {
          const dt = (timeStamp - lastTimestamp) / 1000;

          velX += (acc.x ?? 0) * dt;
          velY += (acc.y ?? 0) * dt;
          velZ += (acc.z ?? 0) * dt;
        }

        lastTimestamp = timeStamp;

        acceleration.x = acc.x ?? 0;
        acceleration.y = acc.y ?? 0;
        acceleration.z = acc.z ?? 0;

        gyroscope.x = rotationRate?.alpha ?? 0;
        gyroscope.y = rotationRate?.beta ?? 0;
        gyroscope.z = rotationRate?.gamma ?? 0;
      });
    }

    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', function (event) {
        orientation.alpha = event.alpha ?? 0;
        orientation.beta = event.beta ?? 0;
        orientation.gamma ?? 0;
      });
    }

    function updateDerivedMagnetometer() {
      derivedMagnetometer.x = Math.sin((orientation.alpha || 0) * Math.PI / 180);
      derivedMagnetometer.y = Math.cos((orientation.beta || 0) * Math.PI / 180);
      derivedMagnetometer.z = Math.sin((orientation.gamma || 0) * Math.PI / 180);
    }

    function updateSensorWidget() {
      // Update accelerometer readings
      document.getElementById('acc-x').innerText = acceleration.x.toFixed(2);
      document.getElementById('acc-y').innerText = acceleration.y.toFixed(2);
      document.getElementById('acc-z').innerText = acceleration.z.toFixed(2);

      // Update gyroscope readings
      document.getElementById('gyr-x').innerText = gyroscope.x.toFixed(2);
      document.getElementById('gyr-y').innerText gyroscope.y.toFixed(2);
      document.getElementById('gyr-z').innerText gyroscope.z.toFixed(2);

      // Update orientation readings
      document.getElementById('ori-alpha').innerText = orientation.alpha.toFixed(2);
      document.getElementById('ori-beta').innerText orientation.beta.toFixed(2);
      document.getElementById('ori-gamma').innerText orientation.gamma.toFixed(2);

      // Update derived magnetometer
      updateDerivedMagnetometer();

      document.getElementById('mag-x').innerText = derivedMagnetometer.x.toFixed(2);
      document.getElementById('mag-y').innerText = derivedMagnetometer.y.toFixed(2);
      document.getElementById('mag-z').innerText = derivedMagnetometer.z.toFixed(2);
    }

    setInterval(updateSensorWidget, 1000); // Update the widget every second
  </script>
</head>
<body>
  <div class="sensor-widget">
    <h2>Sensor Readings</h2>
    
    <div class="sensor-section">
      <h3>Accelerometer</h3>
      <div class="sensor-reading">
        <span>X:</span> <span id="acc-x">0</span>
      </div>
      <div class="sensor-reading">
        <span>Y:</span> <span id="acc-y">0</span>
      </div>
      <div class="sensor-reading">
        <span>Z:</span> <span id="acc-z">0</span>
      </div>
    </div>

    <div class="sensor-section">
      <h3>Gyroscope</h3>
      <div class="sensor-reading">
        <span>X:</span> <span id="gyr-x">0</span>
      </div>
      <div class="sensor-reading">
        <span>Y:</span> <span id="gyr-y">0</span>
      </div>
      <div class="sensor-reading">
        <span>Z:</span> <span id="gyr-z">0</span>
      </div>
    </div>

    <div class="sensor-section">
      <h3>Orientation</h3>
      <div class="sensor-reading">
        <span>Alpha:</span> <span id="ori-alpha">0</span>
      </div>
      <div class="sensor-reading">
        <span>Beta:</span> <span id="ori-beta">0</span>
      </div>
      <div class="sensor-reading">
        <span>Gamma:</span> <span id="ori-gamma">0</span>
      </div>
    </div>

    <div class="sensor-section">
      <h3>Derived Magnetometer</h3>
      <div class="sensor-reading">
        <span>X:</span> <span id="mag-x">0</span>
      </div>
      <div class="sensor-reading">
        <span>Y:</span> <span id="mag-y">0</span>
      </div>
      <div class="sensor-reading">
        <span>Z:</span> <span id="mag-z">0</span>
      </div>
    </div>
  </div>
</body>
</html>
